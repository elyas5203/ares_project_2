# مستندات فنی پروژه دستیار هوش مصنوعی آرس

این مستند به منظور ارائه توضیحات فنی دقیق در مورد پروژه دستیار هوش مصنوعی آرس برای توسعه‌دهندگان آینده تهیه شده است.

## معماری پروژه

پروژه از یک معماری ماژولار بهره می‌برد که در آن هر بخش از برنامه در یک پوشه جداگانه قرار دارد.

-   **`app/`**: این پوشه شامل هسته اصلی برنامه است.
    -   **`core/`**: این بخش شامل منطق اصلی و مشترک بین وب اپلیکیشن و ربات تلگرام است.
        -   `ai.py`: این فایل مسئول ارتباط با مدل زبان (Ollama)، ساخت پرامپت‌ها و پردازش پاسخ‌ها است.
        -   `db.py`: این فایل شامل تمام توابع مربوط به پایگاه داده (ساخت جداول، درج، به‌روزرسانی و حذف داده‌ها) است.
    -   **`telegram_bot/`**: این بخش شامل تمام کدهای مربوط به ربات تلگرام است.
        -   `bot.py`: این فایل اصلی ربات است که مسئول راه‌اندازی، تعریف دستورات و مدیریت پیام‌ها است.
    -   **`web/`**: این بخش شامل تمام کدهای مربوط به وب اپلیکیشن است.
        -   `app.py`: این فایل اصلی وب اپلیکیشن است که با استفاده از Flask ساخته شده و مسئول تعریف روت‌ها و مدیریت درخواست‌ها است.
        -   **`templates/`**: این پوشه شامل تمام فایل‌های HTML است که با استفاده از موتور قالب Jinja2 رندر می‌شوند.
-   **`data/`**: این پوشه محل ذخیره‌سازی فایل پایگاه داده (`database.db`) است.
-   **`uploads/`**: این پوشه محل ذخیره‌سازی فایل‌هایی است که توسط کاربر آپلود می‌شوند.
-   **`venv/`**: این پوشه شامل محیط مجازی پایتون است که برای ایزوله کردن وابستگی‌های پروژه استفاده می‌شود.

## پایگاه داده

پایگاه داده این پروژه از نوع SQLite است که یک پایگاه داده سبک و مبتنی بر فایل است. ساختار جداول به شرح زیر است:

-   **`competitors`**: این جدول برای ذخیره اطلاعات رقبا استفاده می‌شود.
    -   `id`: شناسه منحصر به فرد (Primary Key)
    -   `name`: نام رقیب (TEXT)
    -   `url`: آدرس وب‌سایت رقیب (TEXT)
-   **`chats`**: این جدول برای ذخیره اطلاعات هر جلسه چت استفاده می‌شود.
    -   `id`: شناسه منحصر به فرد (Primary Key)
    -   `title`: عنوان چت (TEXT)
    -   `telegram_chat_id`: شناسه چت در تلگرام (INTEGER)
-   **`messages`**: این جدول برای ذخیره پیام‌های هر چت استفاده می‌شود.
    -   `id`: شناسه منحصر به فرد (Primary Key)
    -   `chat_id`: شناسه چت مربوطه (Foreign Key to `chats.id`)
    -   `role`: نقش فرستنده پیام (user یا ai) (TEXT)
    -   `content`: محتوای پیام (TEXT)
-   **`knowledge_base`**: این جدول برای ذخیره اطلاعاتی که کاربر به هوش مصنوعی می‌دهد استفاده می‌شود.
    -   `id`: شناسه منحصر به فرد (Primary Key)
    -   `content`: محتوای اطلاعات (TEXT)
-   **`products`**: این جدول برای ذخیره اطلاعات محصولات استفاده می‌شود.
    -   `id`: شناسه منحصر به فرد (Primary Key)
    -   `name`: نام محصول (TEXT)
    -   `price`: قیمت محصول (REAL)
    -   `description`: توضیحات محصول (TEXT)
    -   `image`: نام فایل تصویر محصول (TEXT)

## ماژول AI

ماژول `app/core/ai.py` قلب تپنده این پروژه است. این ماژول دو وظیفه اصلی دارد:

1.  **پاسخگویی به سوالات عمومی:** تابع `get_ai_response` یک پرامپت دریافت می‌کند، آن را به همراه تاریخچه مکالمه و اطلاعات پایگاه دانش برای مدل زبان `llama3` از طریق `Ollama` ارسال می‌کند و پاسخ را برمی‌گرداند. پرامپت به گونه‌ای طراحی شده است که AI را مجبور به پاسخگویی به زبان فارسی و با لحنی دوستانه و محاوره‌ای می‌کند.
2.  **تحلیل وب‌سایت رقبا:** تابع `analyze_competitor_website` یک URL دریافت می‌کند، با استفاده از کتابخانه‌های `requests` و `BeautifulSoup` محتوای صفحه را استخراج می‌کند و سپس با ارسال این محتوا به `Ollama`، یک تحلیل کامل از وب‌سایت رقیب (شامل خلاصه محتوا، کلمات کلیدی و نقاط قوت و ضعف) ارائه می‌دهد.

## وب اپلیکیشن

وب اپلیکیشن با استفاده از فریم‌ورک `Flask` ساخته شده است و دارای یک رابط کاربری مدرن با `Tailwind CSS` است. روت‌های اصلی برنامه به شرح زیر است:

-   `/`: داشبورد
-   `/chat`: صفحه چت با هوش مصنوعی
-   `/competitors`: صفحه مدیریت و تحلیل رقبا
-   `/products`: صفحه مدیریت محصولات

وب اپلیکیشن همچنین دارای یک API برای مدیریت چت‌ها است که توسط جاوااسکریپت در سمت کلاینت استفاده می‌شود.

## ربات تلگرام

ربات تلگرام با استفاده از کتابخانه‌ی `python-telegram-bot` ساخته شده است و دارای قابلیت‌های زیر است:

-   **پاسخگویی به دستورات:** ربات به دستورات `/start`، `/post`، `/add_competitor` و `/add_knowledge` پاسخ می‌دهد.
-   **پردازش زبان طبیعی:** ربات با استفاده از کتابخانه‌ی `hazm`، پیام‌های متنی کاربر را تحلیل می‌کند و در صورتی که کلمات کلیدی خاصی (مثل "آخرین محصول") را تشخیص دهد، پاسخ مناسب را ارسال می‌کند.
-   **مکالمه هوشمند:** در صورتی که هیچ دستور یا کلمه کلیدی خاصی تشخیص داده نشود، پیام کاربر به عنوان یک پیام عادی در نظر گرفته شده و برای `Ollama` ارسال می‌شود تا یک مکالمه هوشمند شکل بگیرد.

## راهنمای توسعه

برای اضافه کردن قابلیت‌های جدید به پروژه، می‌توانید از راهنمای زیر استفاده کنید:

-   **اضافه کردن یک صفحه جدید به وب اپلیکیشن:**
    1.  یک فایل HTML جدید در پوشه‌ی `app/web/templates/` بسازید و از `base.html` ارث‌بری کنید.
    2.  یک روت جدید در فایل `app/web/app.py` تعریف کنید و فایل HTML جدید را رندر کنید.
    3.  لینک صفحه جدید را در فایل `app/web/templates/base.html` اضافه کنید.
-   **اضافه کردن یک دستور جدید به ربات تلگرام:**
    1.  یک تابع `async` جدید در فایل `app/telegram_bot/bot.py` تعریف کنید.
    2.  یک `CommandHandler` جدید در تابع `main` اضافه کنید و تابع خود را به آن متصل کنید.
-   **اضافه کردن قابلیت جدید به NLP ربات:**
    1.  در تابع `handle_message` در فایل `app/telegram_bot/bot.py`، یک شرط جدید برای تشخیص کلمات کلیدی مورد نظر خود اضافه کنید.
    2.  منطق مربوط به قابلیت جدید را در داخل شرط پیاده‌سازی کنید.
-   **اضافه کردن یک جدول جدید به پایگاه داده:**
    1.  در تابع `init_db` در فایل `app/core/db.py`، دستور `CREATE TABLE` مربوط به جدول جدید را اضافه کنید.
    2.  توابع مربوط به درج، به‌روزرسانی و حذف داده‌ها از جدول جدید را در همان فایل اضافه کنید.
    3.  فایل `database.db` را حذف کرده و با اجرای دستور `python -c "from app.core.db import init_db; init_db()"`، پایگاه داده را مجددا بسازید.

امیدوارم این مستندات به شما در توسعه‌ی این پروژه کمک کند.
